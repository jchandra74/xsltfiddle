<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">

		<title>XSLT Fiddle</title>

		<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
		<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.css" />
		<link rel="stylesheet" href="bower_components/codemirror/lib/codemirror.css" />
		<link rel="stylesheet" href="bower_components/codemirror/addon/dialog/dialog.css" />
		<link rel="stylesheet" href="bower_components/codemirror/addon/search/matchesonscrollbar.css" />
		<link rel="stylesheet" href="bower_components/codemirror/addon/fold/foldgutter.css" />
		<link rel="stylesheet" href="bower_components/codemirror/addon/hint/show-hint.css" />
		<link rel="stylesheet" href="bower_components/codemirror/theme/monokai.css" />

		<style type="text/css">
			body {
				margin-top:70px;
			}
		</style>


	 	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->
	</head>
	<body>
		<form>

		<nav class="navbar navbar-inverse navbar-fixed-top">
		  <div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		      <a class="navbar-brand" href="#">XSLT Fiddle</a>
		    </div>

		    <!-- Collect the nav links, forms, and other content for toggling -->
		    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		      	<ul class="nav navbar-nav">
					<li><a href="#"><i class="glyphicon glyphicon-play"></i> Run</a></li>
			      </ul>
			    </div><!-- /.navbar-collapse -->
			  </div><!-- /.container-fluid -->
			</nav>

			<div class="container-fluid">

				<div class="row">
					<div class="col-md-6">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h2 class="panel-title">XML Editor</h2>
							</div>
							<div class="panel-body">
								<textarea id="xmlEdit">&lt;Invoice&gt;
&lt;/Invoice&gt;</textarea>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h2 class="panel-title">XSLT Editor</h2>
							</div>
							<div class="panel-body">					
								<textarea id="xsltEdit">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt"
    xmlns:user="urn:my-scripts"&gt;

    &lt;xsl:template match="/"&gt;
    &lt;/xsl:template&gt;

	&lt;msxsl:script language="C#" implements-prefix="user"&gt;
	&lt;![CDATA[
		//TODO: Add C# function here...
	]]&gt;
	&lt;/msxsl:script&gt;    
&lt;/xsl:stylesheet&gt;</textarea>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-md-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h2 class="panel-title">Result</h2>
							</div>
							<div class="panel-body">
								<textarea id="result">&lt;Invoice&gt;
&lt;/Invoice&gt;</textarea>
							</div>
						</div>
					</div>
				</div>

			</div>
		</form>

		<script src="bower_components/codemirror/lib/codemirror.js"></script>
		<script src="bower_components/codemirror/addon/dialog/dialog.js"></script>
		<script src="bower_components/codemirror/addon/search/searchcursor.js"></script>
		<script src="bower_components/codemirror/addon/search/search.js"></script>
		<script src="bower_components/codemirror/addon/search/matchesonscrollbar.js"></script>
		<script src="bower_components/codemirror/addon/scroll/annotatescrollbar.js"></script>
		<script src="bower_components/codemirror/addon/edit/closetag.js"></script>
		<script src="bower_components/codemirror/addon/fold/foldcode.js"></script>
		<script src="bower_components/codemirror/addon/fold/foldgutter.js"></script>
		<script src="bower_components/codemirror/addon/fold/xml-fold.js"></script>
		<script src="bower_components/codemirror/addon/hint/show-hint.js"></script>
		<script src="bower_components/codemirror/addon/hint/xml-hint.js"></script>
		<script src="bower_components/codemirror/addon/edit/closetag.js"></script>
		<script src="bower_components/codemirror/addon/edit/matchtags.js"></script>
		<script src="bower_components/codemirror/addon/selection/active-line.js"></script>
		<script src="bower_components/codemirror/mode/xml/xml.js"></script>

		<script>
			(function() {
				'use strict';

				var tags = {

				};

				function completeAfter(cm, pred) {
					var cur = cm.getCursor();
					if (!pred || pred()) setTimeout(function() {
						if (!cm.state.completionActive)
						cm.showHint({completeSingle: false});
					}, 100);
					return CodeMirror.Pass;
				}

				function completeIfAfterLt(cm) {
					return completeAfter(cm, function() {
						var cur = cm.getCursor();
						return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == "<";
					});
				}

				function completeIfInTag(cm) {
					return completeAfter(cm, function() {
						var tok = cm.getTokenAt(cm.getCursor());
						if (tok.type == "string" && (!/['"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;
						var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;
						return inner.tagName;
					});
				}

				var xmlEditor = CodeMirror.fromTextArea(document.getElementById('xmlEdit'), {
					mode: "xml",
					lineNumbers: true,
					styleActiveLine: true,
					foldGutter: true,
    				gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
					hintOptions: { schemaInfo: tags },
					theme: 'monokai',
					matchTags: true,
					autoCloseTags: true,
					extraKeys: {
						"'<'": completeAfter,
						"'/'": completeIfAfterLt,
						"' '": completeIfInTag,
						"'='": completeIfInTag,
						"Ctrl-Space": "autocomplete"
					}
				});

				var xsltEditor = CodeMirror.fromTextArea(document.getElementById('xsltEdit'), {
					mode: "xml",
					lineNumbers: true,
					styleActiveLine: true,
					foldGutter: true,
    				gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],					
					theme: 'monokai',
					hintOptions: { schemaInfo: tags },
					matchTags: true,
					autoCloseTags: true,
					extraKeys: {
						"'<'": completeAfter,
						"'/'": completeIfAfterLt,
						"' '": completeIfInTag,
						"'='": completeIfInTag,
						"Ctrl-Space": "autocomplete"
					}
				});

				var resultEditor = CodeMirror.fromTextArea(document.getElementById('result'), {
					mode: "xml",
					lineNumbers: true,
					theme: 'monokai',
					readOnly: 'nocursor',
				});

				window.viewBag = window.viewBag || {};
				window.viewBag.xmlEditor = xmlEditor;
				window.viewBag.xsltEditor = xsltEditor;
				window.viewBag.resultEditor = resultEditor;

				window.viewBag.resultEditor.setValue('<!-- click Run to see the XSLT transform result -->');

			}());
		</script>
	</body>
</html>